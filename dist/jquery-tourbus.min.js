(function(){var t,i,e,s,o,n,r,h,l,u,a,p,c=[].slice;t=jQuery,o=t.tourbus=function(){var i,e;return i=arguments.length>=1?c.call(arguments,0):[],e=i[0],s.hasOwnProperty(e)?i=i.slice(1):e instanceof t?e="build":"string"==typeof e?(e="build",i[0]=t(i[0])):t.error("Unknown method of $.tourbus --",i),s[e].apply(this,i)},t.fn.tourbus=function(){var i;return i=arguments.length>=1?c.call(arguments,0):[],this.each(function(){return i.unshift(t(this)),o.apply(null,["build"].concat(c.call(i))),this})},s={build:function(i,e){var s;return null==e&&(e={}),e=t.extend(!0,{},o.defaults,e),s=[],i instanceof t||(i=t(i)),i.each(function(){return s.push(h(this,e))}),0===s.length&&t.error(""+i.selector+" was not found!"),1===s.length?s[0]:s},destroyAll:function(){var t,i,e;e=[];for(i in l)t=l[i],e.push(t.destroy());return e},expose:function(t){return t.tourbus={Bus:i,Leg:e}}},o.defaults={debug:!1,autoDepart:!1,target:"body",startAt:0,onDepart:function(){return null},onStop:function(){return null},onLegStart:function(){return null},onLegEnd:function(){return null},leg:{scrollTo:null,scrollSpeed:150,scrollContext:100,orientation:"bottom",align:"left",width:"auto",margin:10,top:null,left:null,zindex:9999,arrow:"50%"}},i=function(){function i(i,e){this.id=n(),this.$target=t(e.target),this.$el=t(i),this.$el.data({tourbus:this}),this.options=e,this.currentLegIndex=null,this.legs=null,this.legEls=this.$el.children("li"),this.totalLegs=this.legEls.length,this._setupEvents(),this.options.autoDepart&&this.$el.trigger("depart.tourbus"),this._log("built tourbus with el",""+i,"and options",this.options)}return i.prototype.depart=function(){return this.running=!0,this.options.onDepart(this),this._log("departing",this),this.legs=this._buildLegs(),this.currentLegIndex=this.options.startAt,this.showLeg()},i.prototype.stop=function(){return this.running?(this.legs&&t.each(this.legs,t.proxy(this.hideLeg,this)),this.currentLegIndex=this.options.startAt,this.options.onStop(this),this.running=!1):void 0},i.prototype.on=function(t,i,e){return this.$target.on(t,i,e)},i.prototype.currentLeg=function(){return null===this.currentLegIndex?null:this.legs[this.currentLegIndex]},i.prototype.showLeg=function(t){var i,e;return null==t&&(t=this.currentLegIndex),i=this.legs[t],this._log("showLeg:",i),e=this.options.onLegStart(i,this),e!==!1?i.show():void 0},i.prototype.hideLeg=function(t){var i,e;return null==t&&(t=this.currentLegIndex),i=this.legs[t],i.visible&&(this._log("hideLeg:",i),e=this.options.onLegEnd(i,this),e!==!1)?i.hide():void 0},i.prototype.repositionLegs=function(){return this.legs?t.each(this.legs,function(){return this.reposition()}):void 0},i.prototype.next=function(){return this.hideLeg(),this.currentLegIndex++,this.currentLegIndex>this.totalLegs-1?this.stop():this.showLeg()},i.prototype.prev=function(){return this.hideLeg(),this.currentLegIndex--,0>this.currentLegIndex?this.stop():this.showLeg()},i.prototype.destroy=function(){return this.legs&&t.each(this.legs,function(){return this.destroy()}),this.legs=null,delete l[this.id],this._teardownEvents()},i.prototype._buildLegs=function(){var i=this;return this.legs&&t.each(this.legs,function(t,i){return i.destroy()}),t.map(this.legEls,function(s,o){var n,r,h;return n=t(s),r=n.data(),h=new e({content:n.html(),target:r.el||"body",bus:i,index:o,rawData:r}),h.render(),i.$target.append(h.$el),h._position(),h.hide(),h})},i.prototype._log=function(){return this.options.debug?console.log.apply(console,["TOURBUS "+this.id+":"].concat(c.call(arguments))):void 0},i.prototype._setupEvents=function(){return this.$el.on("depart.tourbus",t.proxy(this.depart,this)),this.$el.on("stop.tourbus",t.proxy(this.stop,this)),this.$el.on("next.tourbus",t.proxy(this.next,this)),this.$el.on("prev.tourbus",t.proxy(this.prev,this))},i.prototype._teardownEvents=function(){return this.$el.off(".tourbus")},i}(),e=function(){function i(i){if(this.bus=i.bus,this.rawData=i.rawData,this.content=i.content,this.index=i.index,this.options=i,this.$target=t(i.target),this.visible=!1,0===this.$target.length)throw""+this.$target.selector+" is not an element!";this._setupOptions(),this._configureElement(),this._configureTarget(),this._configureScroll(),this._setupEvents(),this.bus._log("leg "+this.index+" made with options",this.options)}return i.prototype.render=function(){var t,i;return t="centered"===this.options.orientation?"":"tourbus-arrow",this.$el.addClass(" "+t+" tourbus-arrow-"+this.options.orientation+" "),i="<div class='tourbus-leg-inner'>\n  "+this.content+"\n</div>",this.$el.css({width:this.options.width,zIndex:this.options.zindex}).html(i),this},i.prototype.destroy=function(){return this.$el.remove(),this._teardownEvents()},i.prototype.reposition=function(){return this._configureTarget(),this._position()},i.prototype._position=function(){var t,i,e,s;return"centered"!==this.options.orientation&&(e={},i={top:"left",bottom:"left",left:"top",right:"top"},"number"==typeof this.options.arrow&&(this.options.arrow+="px"),e[i[this.options.orientation]]=this.options.arrow,s="#"+this.id+".tourbus-arrow",this.bus._log("adding rule for "+this.id,e),r(""+s+":before, "+s+":after",e)),t=this._offsets(),this.bus._log("setting offsets on leg",t),this.$el.css(t)},i.prototype.show=function(){return this.visible=!0,this.$el.css({visibility:"visible",opacity:1,zIndex:this.options.zindex}),this.scrollIntoView()},i.prototype.hide=function(){return this.visible=!1,this.bus.options.debug?this.$el.css({visibility:"visible",opacity:.4,zIndex:0}):this.$el.css({visibility:"hidden"})},i.prototype.scrollIntoView=function(){var i;if(this.willScroll)return i=u(this.options.scrollTo,this.$el),this.bus._log("scrolling to",i,this.scrollSettings),t.scrollTo(i,this.scrollSettings)},i.prototype._setupOptions=function(){var t;return t=this.bus.options.leg,this.options.top=u(this.rawData.top,t.top),this.options.left=u(this.rawData.left,t.left),this.options.scrollTo=u(this.rawData.scrollTo,t.scrollTo),this.options.scrollSpeed=u(this.rawData.scrollSpeed,t.scrollSpeed),this.options.scrollContext=u(this.rawData.scrollContext,t.scrollContext),this.options.margin=u(this.rawData.margin,t.margin),this.options.arrow=this.rawData.arrow||t.arrow,this.options.align=this.rawData.align||t.align,this.options.width=this.rawData.width||t.width,this.options.zindex=this.rawData.zindex||t.zindex,this.options.orientation=this.rawData.orientation||t.orientation},i.prototype._configureElement=function(){return this.id="tourbus-leg-id-"+this.bus.id+"-"+this.options.index,this.$el=t("<div class='tourbus-leg'></div>"),this.el=this.$el[0],this.$el.attr({id:this.id}),this.$el.css({zIndex:this.options.zindex})},i.prototype._setupEvents=function(){return this.$el.on("click",".tourbus-next",t.proxy(this.bus.next,this.bus)),this.$el.on("click",".tourbus-prev",t.proxy(this.bus.prev,this.bus)),this.$el.on("click",".tourbus-stop",t.proxy(this.bus.stop,this.bus))},i.prototype._teardownEvents=function(){return this.$el.off("click")},i.prototype._configureTarget=function(){return this.targetOffset=this.$target.offset(),u(this.options.top,!1)&&(this.targetOffset.top=this.options.top),u(this.options.left,!1)&&(this.targetOffset.left=this.options.left),this.targetWidth=this.$target.outerWidth(),this.targetHeight=this.$target.outerHeight()},i.prototype._configureScroll=function(){return this.willScroll=t.fn.scrollTo&&this.options.scrollTo!==!1,this.scrollSettings={offset:-this.options.scrollContext,easing:"linear",axis:"y",duration:this.options.scrollSpeed}},i.prototype._offsets=function(){var i,e,s,o,n,r,h,l;switch(s=this.$el.height(),o=this.$el.width(),n={},this.options.orientation){case"centered":h=t(window).height(),n.top=this.options.top,u(n.top,!1)||(n.top=h/2-s/2),n.left=this.targetWidth/2-o/2;break;case"left":n.top=this.targetOffset.top,n.left=this.targetOffset.left-o-this.options.margin;break;case"right":n.top=this.targetOffset.top,n.left=this.targetOffset.left+this.targetWidth+this.options.margin;break;case"top":n.top=this.targetOffset.top-s-this.options.margin,n.left=this.targetOffset.left;break;case"bottom":n.top=this.targetOffset.top+this.targetHeight+this.options.margin,n.left=this.targetOffset.left}if(l={top:["left","right"],bottom:["left","right"],left:["top","bottom"],right:["top","bottom"]},a(this.options.orientation,l[this.options.align]))switch(this.options.align){case"right":n.left+=this.targetWidth-o;break;case"bottom":n.top+=this.targetHeight-s}else"center"===this.options.align&&(a(this.options.orientation,l.left)?(r=this.targetWidth/2,e=o/2,i="left"):(r=this.targetHeight/2,e=s/2,i="top"),r>e?n[i]+=r-e:n[i]-=e-r);return n},i}(),p=0,n=function(){return p++},l={},h=function(){var t;return t=function(t,i,e){e.prototype=t.prototype;var s=new e,o=t.apply(s,i);return Object(o)===o?o:s}(i,arguments,function(){}),l[t.id]=t,t},u=function(t,i){return null===t||t===void 0?i:t},a=function(i,e){return-1!==t.inArray(i,e||[])},r=function(i){var e;return i.type="text/css",document.getElementsByTagName("head")[0].appendChild(i),e=document.styleSheets[document.styleSheets.length-1],function(i,s){var o,n;n=t.map(function(){var t;t=[];for(o in s)t.push(o);return t}(),function(t){return""+t+":"+s[t]}).join(";");try{e.insertRule?e.insertRule(""+i+" { "+n+" }",(e.cssRules||e.rules).length):e.addRule(i,n)}catch(r){}}}(document.createElement("style"))}).call(this);